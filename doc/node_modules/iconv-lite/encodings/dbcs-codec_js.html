<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>dbcs-codec.js - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
</script>

<script src="../../../js/jquery.js"></script>
<script src="../../../js/darkfish.js"></script>

<link href="../../../css/fonts.css" rel="stylesheet">
<link href="../../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../../Models/veggies_js.html">veggies.js</a>
  
    <li><a href="../../../express-partner-lab/README_md.html">README</a>
  
    <li><a href="../../../node_modules/accepts/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/accepts/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/accepts/README_md.html">README</a>
  
    <li><a href="../../../node_modules/accepts/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/accepts/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/array-flatten/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/array-flatten/README_md.html">README</a>
  
    <li><a href="../../../node_modules/array-flatten/array-flatten_js.html">array-flatten.js</a>
  
    <li><a href="../../../node_modules/array-flatten/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/body-parser/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/body-parser/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/body-parser/README_md.html">README</a>
  
    <li><a href="../../../node_modules/body-parser/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/body-parser/lib/read_js.html">read.js</a>
  
    <li><a href="../../../node_modules/body-parser/lib/types/json_js.html">json.js</a>
  
    <li><a href="../../../node_modules/body-parser/lib/types/raw_js.html">raw.js</a>
  
    <li><a href="../../../node_modules/body-parser/lib/types/text_js.html">text.js</a>
  
    <li><a href="../../../node_modules/body-parser/lib/types/urlencoded_js.html">urlencoded.js</a>
  
    <li><a href="../../../node_modules/body-parser/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/bytes/History_md.html">History</a>
  
    <li><a href="../../../node_modules/bytes/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/bytes/Readme_md.html">Readme</a>
  
    <li><a href="../../../node_modules/bytes/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/bytes/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/content-disposition/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/content-disposition/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/content-disposition/README_md.html">README</a>
  
    <li><a href="../../../node_modules/content-disposition/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/content-disposition/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/content-type/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/content-type/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/content-type/README_md.html">README</a>
  
    <li><a href="../../../node_modules/content-type/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/content-type/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/cookie-signature/History_md.html">History</a>
  
    <li><a href="../../../node_modules/cookie-signature/Readme_md.html">Readme</a>
  
    <li><a href="../../../node_modules/cookie-signature/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/cookie-signature/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/cookie/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/cookie/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/cookie/README_md.html">README</a>
  
    <li><a href="../../../node_modules/cookie/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/cookie/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/debug/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/debug/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/debug/Makefile.html">Makefile</a>
  
    <li><a href="../../../node_modules/debug/README_md.html">README</a>
  
    <li><a href="../../../node_modules/debug/component_json.html">component.json</a>
  
    <li><a href="../../../node_modules/debug/karma_conf_js.html">karma.conf.js</a>
  
    <li><a href="../../../node_modules/debug/node_js.html">node.js</a>
  
    <li><a href="../../../node_modules/debug/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/debug/src/browser_js.html">browser.js</a>
  
    <li><a href="../../../node_modules/debug/src/debug_js.html">debug.js</a>
  
    <li><a href="../../../node_modules/debug/src/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/debug/src/inspector-log_js.html">inspector-log.js</a>
  
    <li><a href="../../../node_modules/debug/src/node_js.html">node.js</a>
  
    <li><a href="../../../node_modules/depd/History_md.html">History</a>
  
    <li><a href="../../../node_modules/depd/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/depd/Readme_md.html">Readme</a>
  
    <li><a href="../../../node_modules/depd/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/depd/lib/browser/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/depd/lib/compat/callsite-tostring_js.html">callsite-tostring.js</a>
  
    <li><a href="../../../node_modules/depd/lib/compat/event-listener-count_js.html">event-listener-count.js</a>
  
    <li><a href="../../../node_modules/depd/lib/compat/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/depd/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/destroy/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/destroy/README_md.html">README</a>
  
    <li><a href="../../../node_modules/destroy/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/destroy/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/ee-first/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/ee-first/README_md.html">README</a>
  
    <li><a href="../../../node_modules/ee-first/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/ee-first/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/ejs/Jakefile.html">Jakefile</a>
  
    <li><a href="../../../node_modules/ejs/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/ejs/README_md.html">README</a>
  
    <li><a href="../../../node_modules/ejs/ejs_js.html">ejs.js</a>
  
    <li><a href="../../../node_modules/ejs/ejs_min_js.html">ejs.min.js</a>
  
    <li><a href="../../../node_modules/ejs/lib/ejs_js.html">ejs.js</a>
  
    <li><a href="../../../node_modules/ejs/lib/utils_js.html">utils.js</a>
  
    <li><a href="../../../node_modules/ejs/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/encodeurl/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/encodeurl/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/encodeurl/README_md.html">README</a>
  
    <li><a href="../../../node_modules/encodeurl/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/encodeurl/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/escape-html/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/escape-html/Readme_md.html">Readme</a>
  
    <li><a href="../../../node_modules/escape-html/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/escape-html/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/etag/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/etag/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/etag/README_md.html">README</a>
  
    <li><a href="../../../node_modules/etag/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/etag/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/express/History_md.html">History</a>
  
    <li><a href="../../../node_modules/express/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/express/Readme_md.html">Readme</a>
  
    <li><a href="../../../node_modules/express/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/express/lib/application_js.html">application.js</a>
  
    <li><a href="../../../node_modules/express/lib/express_js.html">express.js</a>
  
    <li><a href="../../../node_modules/express/lib/middleware/init_js.html">init.js</a>
  
    <li><a href="../../../node_modules/express/lib/middleware/query_js.html">query.js</a>
  
    <li><a href="../../../node_modules/express/lib/request_js.html">request.js</a>
  
    <li><a href="../../../node_modules/express/lib/response_js.html">response.js</a>
  
    <li><a href="../../../node_modules/express/lib/router/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/express/lib/router/layer_js.html">layer.js</a>
  
    <li><a href="../../../node_modules/express/lib/router/route_js.html">route.js</a>
  
    <li><a href="../../../node_modules/express/lib/utils_js.html">utils.js</a>
  
    <li><a href="../../../node_modules/express/lib/view_js.html">view.js</a>
  
    <li><a href="../../../node_modules/express/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/finalhandler/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/finalhandler/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/finalhandler/README_md.html">README</a>
  
    <li><a href="../../../node_modules/finalhandler/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/finalhandler/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/forwarded/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/forwarded/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/forwarded/README_md.html">README</a>
  
    <li><a href="../../../node_modules/forwarded/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/forwarded/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/fresh/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/fresh/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/fresh/README_md.html">README</a>
  
    <li><a href="../../../node_modules/fresh/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/fresh/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/http-errors/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/http-errors/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/http-errors/README_md.html">README</a>
  
    <li><a href="../../../node_modules/http-errors/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/http-errors/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/Changelog_md.html">Changelog</a>
  
    <li><a href="../../../node_modules/iconv-lite/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/iconv-lite/README_md.html">README</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/dbcs-codec_js.html">dbcs-codec.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/dbcs-data_js.html">dbcs-data.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/internal_js.html">internal.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-codec_js.html">sbcs-codec.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-data-generated_js.html">sbcs-data-generated.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-data_js.html">sbcs-data.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/big5-added_json.html">big5-added.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp936_json.html">cp936.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp949_json.html">cp949.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp950_json.html">cp950.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/eucjp_json.html">eucjp.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/gb18030-ranges_json.html">gb18030-ranges.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/gbk-added_json.html">gbk-added.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/shiftjis_json.html">shiftjis.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/utf16_js.html">utf16.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/utf7_js.html">utf7.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/bom-handling_js.html">bom-handling.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/extend-node_js.html">extend-node.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/streams_js.html">streams.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/inherits/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/inherits/README_md.html">README</a>
  
    <li><a href="../../../node_modules/inherits/inherits_js.html">inherits.js</a>
  
    <li><a href="../../../node_modules/inherits/inherits_browser_js.html">inherits_browser.js</a>
  
    <li><a href="../../../node_modules/inherits/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/ipaddr_js/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/ipaddr_js/README_md.html">README</a>
  
    <li><a href="../../../node_modules/ipaddr_js/ipaddr_min_js.html">ipaddr.min.js</a>
  
    <li><a href="../../../node_modules/ipaddr_js/lib/ipaddr_js.html">ipaddr.js</a>
  
    <li><a href="../../../node_modules/ipaddr_js/lib/ipaddr_js_d_ts.html">ipaddr.js.d.ts</a>
  
    <li><a href="../../../node_modules/ipaddr_js/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/media-typer/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/media-typer/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/media-typer/README_md.html">README</a>
  
    <li><a href="../../../node_modules/media-typer/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/media-typer/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/merge-descriptors/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/merge-descriptors/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/merge-descriptors/README_md.html">README</a>
  
    <li><a href="../../../node_modules/merge-descriptors/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/merge-descriptors/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/method-override/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/method-override/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/method-override/README_md.html">README</a>
  
    <li><a href="../../../node_modules/method-override/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/Makefile.html">Makefile</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/README_md.html">README</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/karma_conf_js.html">karma.conf.js</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/node_js.html">node.js</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/src/browser_js.html">browser.js</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/src/debug_js.html">debug.js</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/src/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/method-override/node_modules/debug/src/node_js.html">node.js</a>
  
    <li><a href="../../../node_modules/method-override/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/methods/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/methods/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/methods/README_md.html">README</a>
  
    <li><a href="../../../node_modules/methods/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/methods/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mime-db/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/mime-db/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mime-db/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mime-db/db_json.html">db.json</a>
  
    <li><a href="../../../node_modules/mime-db/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/mime-db/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mime-types/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/mime-types/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mime-types/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mime-types/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/mime-types/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mime/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/mime/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mime/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mime/cli_js.html">cli.js</a>
  
    <li><a href="../../../node_modules/mime/mime_js.html">mime.js</a>
  
    <li><a href="../../../node_modules/mime/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mime/src/build_js.html">build.js</a>
  
    <li><a href="../../../node_modules/mime/src/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/mime/types_json.html">types.json</a>
  
    <li><a href="../../../node_modules/ms/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/ms/license_md.html">license</a>
  
    <li><a href="../../../node_modules/ms/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/ms/readme_md.html">readme</a>
  
    <li><a href="../../../node_modules/negotiator/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/negotiator/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/negotiator/README_md.html">README</a>
  
    <li><a href="../../../node_modules/negotiator/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/negotiator/lib/charset_js.html">charset.js</a>
  
    <li><a href="../../../node_modules/negotiator/lib/encoding_js.html">encoding.js</a>
  
    <li><a href="../../../node_modules/negotiator/lib/language_js.html">language.js</a>
  
    <li><a href="../../../node_modules/negotiator/lib/mediaType_js.html">mediaType.js</a>
  
    <li><a href="../../../node_modules/negotiator/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/on-finished/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/on-finished/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/on-finished/README_md.html">README</a>
  
    <li><a href="../../../node_modules/on-finished/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/on-finished/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/parseurl/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/parseurl/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/parseurl/README_md.html">README</a>
  
    <li><a href="../../../node_modules/parseurl/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/parseurl/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/path-to-regexp/History_md.html">History</a>
  
    <li><a href="../../../node_modules/path-to-regexp/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/path-to-regexp/Readme_md.html">Readme</a>
  
    <li><a href="../../../node_modules/path-to-regexp/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/path-to-regexp/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/proxy-addr/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/proxy-addr/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/proxy-addr/README_md.html">README</a>
  
    <li><a href="../../../node_modules/proxy-addr/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/proxy-addr/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/qs/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/qs/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/qs/README_md.html">README</a>
  
    <li><a href="../../../node_modules/qs/dist/qs_js.html">qs.js</a>
  
    <li><a href="../../../node_modules/qs/lib/formats_js.html">formats.js</a>
  
    <li><a href="../../../node_modules/qs/lib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/qs/lib/parse_js.html">parse.js</a>
  
    <li><a href="../../../node_modules/qs/lib/stringify_js.html">stringify.js</a>
  
    <li><a href="../../../node_modules/qs/lib/utils_js.html">utils.js</a>
  
    <li><a href="../../../node_modules/qs/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/qs/test/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/qs/test/parse_js.html">parse.js</a>
  
    <li><a href="../../../node_modules/qs/test/stringify_js.html">stringify.js</a>
  
    <li><a href="../../../node_modules/qs/test/utils_js.html">utils.js</a>
  
    <li><a href="../../../node_modules/range-parser/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/range-parser/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/range-parser/README_md.html">README</a>
  
    <li><a href="../../../node_modules/range-parser/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/range-parser/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/raw-body/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/raw-body/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/raw-body/README_md.html">README</a>
  
    <li><a href="../../../node_modules/raw-body/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../../node_modules/raw-body/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/raw-body/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/safe-buffer/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/safe-buffer/README_md.html">README</a>
  
    <li><a href="../../../node_modules/safe-buffer/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../../node_modules/safe-buffer/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/safe-buffer/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/safer-buffer/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/safer-buffer/Porting-Buffer_md.html">Porting-Buffer</a>
  
    <li><a href="../../../node_modules/safer-buffer/Readme_md.html">Readme</a>
  
    <li><a href="../../../node_modules/safer-buffer/dangerous_js.html">dangerous.js</a>
  
    <li><a href="../../../node_modules/safer-buffer/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/safer-buffer/safer_js.html">safer.js</a>
  
    <li><a href="../../../node_modules/safer-buffer/tests_js.html">tests.js</a>
  
    <li><a href="../../../node_modules/send/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/send/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/send/README_md.html">README</a>
  
    <li><a href="../../../node_modules/send/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/send/node_modules/ms/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/send/node_modules/ms/license_md.html">license</a>
  
    <li><a href="../../../node_modules/send/node_modules/ms/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/send/node_modules/ms/readme_md.html">readme</a>
  
    <li><a href="../../../node_modules/send/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/serve-static/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/serve-static/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/serve-static/README_md.html">README</a>
  
    <li><a href="../../../node_modules/serve-static/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/serve-static/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/setprototypeof/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/setprototypeof/README_md.html">README</a>
  
    <li><a href="../../../node_modules/setprototypeof/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../../node_modules/setprototypeof/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/setprototypeof/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/setprototypeof/test/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/statuses/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/statuses/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/statuses/README_md.html">README</a>
  
    <li><a href="../../../node_modules/statuses/codes_json.html">codes.json</a>
  
    <li><a href="../../../node_modules/statuses/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/statuses/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/toidentifier/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/toidentifier/README_md.html">README</a>
  
    <li><a href="../../../node_modules/toidentifier/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/toidentifier/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/type-is/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/type-is/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/type-is/README_md.html">README</a>
  
    <li><a href="../../../node_modules/type-is/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/type-is/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/unpipe/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/unpipe/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/unpipe/README_md.html">README</a>
  
    <li><a href="../../../node_modules/unpipe/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/unpipe/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/utils-merge/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/utils-merge/README_md.html">README</a>
  
    <li><a href="../../../node_modules/utils-merge/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/utils-merge/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/vary/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../../node_modules/vary/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/vary/README_md.html">README</a>
  
    <li><a href="../../../node_modules/vary/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/vary/package_json.html">package.json</a>
  
    <li><a href="../../../package-lock_json.html">package-lock.json</a>
  
    <li><a href="../../../package_json.html">package.json</a>
  
    <li><a href="../../../server_js.html">server.js</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page node_modules/iconv-lite/encodings/dbcs-codec.js">

<p>“use strict”; var Buffer = require(“safer-buffer”).Buffer;</p>

<p>// Multibyte codec. In this scheme, a character is represented by 1 or more
bytes. // Our codec supports UTF-16 surrogates, extensions for GB18030 and
unicode sequences. // To save memory and loading time, we read table files
only when requested.</p>

<p>exports._dbcs = DBCSCodec;</p>

<p>var UNASSIGNED = -1,</p>

<pre>GB18030_CODE = -2,
SEQ_START  = -10,
NODE_START = -1000,
UNASSIGNED_NODE = new Array(0x100),
DEF_CHAR = -1;</pre>

<p>for (var i = 0; i &lt; 0x100; i++)</p>

<pre class="ruby"><span class="ruby-constant">UNASSIGNED_NODE</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-constant">UNASSIGNED</span>;
</pre>

<p>// Class DBCSCodec reads and initializes mapping tables. function
DBCSCodec(codecOptions, iconv) {</p>

<pre>this.encodingName = codecOptions.encodingName;
if (!codecOptions)
    throw new Error(&quot;DBCS codec is called without the data.&quot;)
if (!codecOptions.table)
    throw new Error(&quot;Encoding &#39;&quot; + this.encodingName + &quot;&#39; has no data.&quot;);

// Load tables.
var mappingTable = codecOptions.table();

// Decode tables: MBCS -&gt; Unicode.

// decodeTables is a trie, encoded as an array of arrays of integers. Internal arrays are trie nodes and all have len = 256.
// Trie root is decodeTables[0].
// Values: &gt;=  0 -&gt; unicode character code. can be &gt; 0xFFFF
//         == UNASSIGNED -&gt; unknown/unassigned sequence.
//         == GB18030_CODE -&gt; this is the end of a GB18030 4-byte sequence.
//         &lt;= NODE_START -&gt; index of the next node in our trie to process next byte.
//         &lt;= SEQ_START  -&gt; index of the start of a character code sequence, in decodeTableSeq.
this.decodeTables = [];
this.decodeTables[0] = UNASSIGNED_NODE.slice(0); // Create root node.

// Sometimes a MBCS char corresponds to a sequence of unicode chars. We store them as arrays of integers here. 
this.decodeTableSeq = [];

// Actual mapping tables consist of chunks. Use them to fill up decode tables.
for (var i = 0; i &lt; mappingTable.length; i++)
    this._addDecodeChunk(mappingTable[i]);

this.defaultCharUnicode = iconv.defaultCharUnicode;

// Encode tables: Unicode -&gt; DBCS.

// `encodeTable` is array mapping from unicode char to encoded char. All its values are integers for performance.
// Because it can be sparse, it is represented as array of buckets by 256 chars each. Bucket can be null.
// Values: &gt;=  0 -&gt; it is a normal char. Write the value (if &lt;=256 then 1 byte, if &lt;=65536 then 2 bytes, etc.).
//         == UNASSIGNED -&gt; no conversion found. Output a default char.
//         &lt;= SEQ_START  -&gt; it&#39;s an index in encodeTableSeq, see below. The character starts a sequence.
this.encodeTable = [];

// `encodeTableSeq` is used when a sequence of unicode characters is encoded as a single code. We use a tree of
// objects where keys correspond to characters in sequence and leafs are the encoded dbcs values. A special DEF_CHAR key
// means end of sequence (needed when one sequence is a strict subsequence of another).
// Objects are kept separately from encodeTable to increase performance.
this.encodeTableSeq = [];

// Some chars can be decoded, but need not be encoded.
var skipEncodeChars = {};
if (codecOptions.encodeSkipVals)
    for (var i = 0; i &lt; codecOptions.encodeSkipVals.length; i++) {
        var val = codecOptions.encodeSkipVals[i];
        if (typeof val === &#39;number&#39;)
            skipEncodeChars[val] = true;
        else
            for (var j = val.from; j &lt;= val.to; j++)
                skipEncodeChars[j] = true;
    }

// Use decode trie to recursively fill out encode tables.
this._fillEncodeTable(0, 0, skipEncodeChars);

// Add more encoding pairs when needed.
if (codecOptions.encodeAdd) {
    for (var uChar in codecOptions.encodeAdd)
        if (Object.prototype.hasOwnProperty.call(codecOptions.encodeAdd, uChar))
            this._setEncodeChar(uChar.charCodeAt(0), codecOptions.encodeAdd[uChar]);
}

this.defCharSB  = this.encodeTable[0][iconv.defaultCharSingleByte.charCodeAt(0)];
if (this.defCharSB === UNASSIGNED) this.defCharSB = this.encodeTable[0][&#39;?&#39;];
if (this.defCharSB === UNASSIGNED) this.defCharSB = &quot;?&quot;.charCodeAt(0);

// Load &amp; create GB18030 tables when needed.
if (typeof codecOptions.gb18030 === &#39;function&#39;) {
    this.gb18030 = codecOptions.gb18030(); // Load GB18030 ranges.

    // Add GB18030 decode tables.
    var thirdByteNodeIdx = this.decodeTables.length;
    var thirdByteNode = this.decodeTables[thirdByteNodeIdx] = UNASSIGNED_NODE.slice(0);

    var fourthByteNodeIdx = this.decodeTables.length;
    var fourthByteNode = this.decodeTables[fourthByteNodeIdx] = UNASSIGNED_NODE.slice(0);

    for (var i = 0x81; i &lt;= 0xFE; i++) {
        var secondByteNodeIdx = NODE_START - this.decodeTables[0][i];
        var secondByteNode = this.decodeTables[secondByteNodeIdx];
        for (var j = 0x30; j &lt;= 0x39; j++)
            secondByteNode[j] = NODE_START - thirdByteNodeIdx;
    }
    for (var i = 0x81; i &lt;= 0xFE; i++)
        thirdByteNode[i] = NODE_START - fourthByteNodeIdx;
    for (var i = 0x30; i &lt;= 0x39; i++)
        fourthByteNode[i] = GB18030_CODE
}</pre>

<p>}</p>

<p>DBCSCodec.prototype.encoder = DBCSEncoder; DBCSCodec.prototype.decoder =
DBCSDecoder;</p>

<p>// Decoder helpers DBCSCodec.prototype._getDecodeTrieNode = function(addr)
{</p>

<pre>var bytes = [];
for (; addr &gt; 0; addr &gt;&gt;= 8)
    bytes.push(addr &amp; 0xFF);
if (bytes.length == 0)
    bytes.push(0);

var node = this.decodeTables[0];
for (var i = bytes.length-1; i &gt; 0; i--) { // Traverse nodes deeper into the trie.
    var val = node[bytes[i]];

    if (val == UNASSIGNED) { // Create new node.
        node[bytes[i]] = NODE_START - this.decodeTables.length;
        this.decodeTables.push(node = UNASSIGNED_NODE.slice(0));
    }
    else if (val &lt;= NODE_START) { // Existing node.
        node = this.decodeTables[NODE_START - val];
    }
    else
        throw new Error(&quot;Overwrite byte in &quot; + this.encodingName + &quot;, addr: &quot; + addr.toString(16));
}
return node;</pre>

<p>}</p>

<p>DBCSCodec.prototype._addDecodeChunk = function(chunk) {</p>

<pre>// First element of chunk is the hex mbcs code where we start.
var curAddr = parseInt(chunk[0], 16);

// Choose the decoding node where we&#39;ll write our chars.
var writeTable = this._getDecodeTrieNode(curAddr);
curAddr = curAddr &amp; 0xFF;

// Write all other elements of the chunk to the table.
for (var k = 1; k &lt; chunk.length; k++) {
    var part = chunk[k];
    if (typeof part === &quot;string&quot;) { // String, write as-is.
        for (var l = 0; l &lt; part.length;) {
            var code = part.charCodeAt(l++);
            if (0xD800 &lt;= code &amp;&amp; code &lt; 0xDC00) { // Decode surrogate
                var codeTrail = part.charCodeAt(l++);
                if (0xDC00 &lt;= codeTrail &amp;&amp; codeTrail &lt; 0xE000)
                    writeTable[curAddr++] = 0x10000 + (code - 0xD800) * 0x400 + (codeTrail - 0xDC00);
                else
                    throw new Error(&quot;Incorrect surrogate pair in &quot;  + this.encodingName + &quot; at chunk &quot; + chunk[0]);
            }
            else if (0x0FF0 &lt; code &amp;&amp; code &lt;= 0x0FFF) { // Character sequence (our own encoding used)
                var len = 0xFFF - code + 2;
                var seq = [];
                for (var m = 0; m &lt; len; m++)
                    seq.push(part.charCodeAt(l++)); // Simple variation: don&#39;t support surrogates or subsequences in seq.

                writeTable[curAddr++] = SEQ_START - this.decodeTableSeq.length;
                this.decodeTableSeq.push(seq);
            }
            else
                writeTable[curAddr++] = code; // Basic char
        }
    } 
    else if (typeof part === &quot;number&quot;) { // Integer, meaning increasing sequence starting with prev character.
        var charCode = writeTable[curAddr - 1] + 1;
        for (var l = 0; l &lt; part; l++)
            writeTable[curAddr++] = charCode++;
    }
    else
        throw new Error(&quot;Incorrect type &#39;&quot; + typeof part + &quot;&#39; given in &quot;  + this.encodingName + &quot; at chunk &quot; + chunk[0]);
}
if (curAddr &gt; 0xFF)
    throw new Error(&quot;Incorrect chunk in &quot;  + this.encodingName + &quot; at addr &quot; + chunk[0] + &quot;: too long&quot; + curAddr);</pre>

<p>}</p>

<p>// Encoder helpers DBCSCodec.prototype._getEncodeBucket = function(uCode) {</p>

<pre>var high = uCode &gt;&gt; 8; // This could be &gt; 0xFF because of astral characters.
if (this.encodeTable[high] === undefined)
    this.encodeTable[high] = UNASSIGNED_NODE.slice(0); // Create bucket on demand.
return this.encodeTable[high];</pre>

<p>}</p>

<p>DBCSCodec.prototype._setEncodeChar = function(uCode, dbcsCode) {</p>

<pre>var bucket = this._getEncodeBucket(uCode);
var low = uCode &amp; 0xFF;
if (bucket[low] &lt;= SEQ_START)
    this.encodeTableSeq[SEQ_START-bucket[low]][DEF_CHAR] = dbcsCode; // There&#39;s already a sequence, set a single-char subsequence of it.
else if (bucket[low] == UNASSIGNED)
    bucket[low] = dbcsCode;</pre>

<p>}</p>

<p>DBCSCodec.prototype._setEncodeSequence = function(seq, dbcsCode) {</p>

<pre>// Get the root of character tree according to first character of the sequence.
var uCode = seq[0];
var bucket = this._getEncodeBucket(uCode);
var low = uCode &amp; 0xFF;

var node;
if (bucket[low] &lt;= SEQ_START) {
    // There&#39;s already a sequence with  - use it.
    node = this.encodeTableSeq[SEQ_START-bucket[low]];
}
else {
    // There was no sequence object - allocate a new one.
    node = {};
    if (bucket[low] !== UNASSIGNED) node[DEF_CHAR] = bucket[low]; // If a char was set before - make it a single-char subsequence.
    bucket[low] = SEQ_START - this.encodeTableSeq.length;
    this.encodeTableSeq.push(node);
}

// Traverse the character tree, allocating new nodes as needed.
for (var j = 1; j &lt; seq.length-1; j++) {
    var oldVal = node[uCode];
    if (typeof oldVal === &#39;object&#39;)
        node = oldVal;
    else {
        node = node[uCode] = {}
        if (oldVal !== undefined)
            node[DEF_CHAR] = oldVal
    }
}

// Set the leaf to given dbcsCode.
uCode = seq[seq.length-1];
node[uCode] = dbcsCode;</pre>

<p>}</p>

<p>DBCSCodec.prototype._fillEncodeTable = function(nodeIdx, prefix,
skipEncodeChars) {</p>

<pre>var node = this.decodeTables[nodeIdx];
for (var i = 0; i &lt; 0x100; i++) {
    var uCode = node[i];
    var mbCode = prefix + i;
    if (skipEncodeChars[mbCode])
        continue;

    if (uCode &gt;= 0)
        this._setEncodeChar(uCode, mbCode);
    else if (uCode &lt;= NODE_START)
        this._fillEncodeTable(NODE_START - uCode, mbCode &lt;&lt; 8, skipEncodeChars);
    else if (uCode &lt;= SEQ_START)
        this._setEncodeSequence(this.decodeTableSeq[SEQ_START - uCode], mbCode);
}</pre>

<p>}</p>

<p>// == Encoder
==================================================================</p>

<p>function DBCSEncoder(options, codec) {</p>

<pre>// Encoder state
this.leadSurrogate = -1;
this.seqObj = undefined;

// Static data
this.encodeTable = codec.encodeTable;
this.encodeTableSeq = codec.encodeTableSeq;
this.defaultCharSingleByte = codec.defCharSB;
this.gb18030 = codec.gb18030;</pre>

<p>}</p>

<p>DBCSEncoder.prototype.write = function(str) {</p>

<pre>var newBuf = Buffer.alloc(str.length * (this.gb18030 ? 4 : 3)),
    leadSurrogate = this.leadSurrogate,
    seqObj = this.seqObj, nextChar = -1,
    i = 0, j = 0;

while (true) {
    // 0. Get next character.
    if (nextChar === -1) {
        if (i == str.length) break;
        var uCode = str.charCodeAt(i++);
    }
    else {
        var uCode = nextChar;
        nextChar = -1;    
    }

    // 1. Handle surrogates.
    if (0xD800 &lt;= uCode &amp;&amp; uCode &lt; 0xE000) { // Char is one of surrogates.
        if (uCode &lt; 0xDC00) { // We&#39;ve got lead surrogate.
            if (leadSurrogate === -1) {
                leadSurrogate = uCode;
                continue;
            } else {
                leadSurrogate = uCode;
                // Double lead surrogate found.
                uCode = UNASSIGNED;
            }
        } else { // We&#39;ve got trail surrogate.
            if (leadSurrogate !== -1) {
                uCode = 0x10000 + (leadSurrogate - 0xD800) * 0x400 + (uCode - 0xDC00);
                leadSurrogate = -1;
            } else {
                // Incomplete surrogate pair - only trail surrogate found.
                uCode = UNASSIGNED;
            }

        }
    }
    else if (leadSurrogate !== -1) {
        // Incomplete surrogate pair - only lead surrogate found.
        nextChar = uCode; uCode = UNASSIGNED; // Write an error, then current char.
        leadSurrogate = -1;
    }

    // 2. Convert uCode character.
    var dbcsCode = UNASSIGNED;
    if (seqObj !== undefined &amp;&amp; uCode != UNASSIGNED) { // We are in the middle of the sequence
        var resCode = seqObj[uCode];
        if (typeof resCode === &#39;object&#39;) { // Sequence continues.
            seqObj = resCode;
            continue;

        } else if (typeof resCode == &#39;number&#39;) { // Sequence finished. Write it.
            dbcsCode = resCode;

        } else if (resCode == undefined) { // Current character is not part of the sequence.

            // Try default character for this sequence
            resCode = seqObj[DEF_CHAR];
            if (resCode !== undefined) {
                dbcsCode = resCode; // Found. Write it.
                nextChar = uCode; // Current character will be written too in the next iteration.

            } else {
                // TODO: What if we have no default? (resCode == undefined)
                // Then, we should write first char of the sequence as-is and try the rest recursively.
                // Didn&#39;t do it for now because no encoding has this situation yet.
                // Currently, just skip the sequence and write current char.
            }
        }
        seqObj = undefined;
    }
    else if (uCode &gt;= 0) {  // Regular character
        var subtable = this.encodeTable[uCode &gt;&gt; 8];
        if (subtable !== undefined)
            dbcsCode = subtable[uCode &amp; 0xFF];

        if (dbcsCode &lt;= SEQ_START) { // Sequence start
            seqObj = this.encodeTableSeq[SEQ_START-dbcsCode];
            continue;
        }

        if (dbcsCode == UNASSIGNED &amp;&amp; this.gb18030) {
            // Use GB18030 algorithm to find character(s) to write.
            var idx = findIdx(this.gb18030.uChars, uCode);
            if (idx != -1) {
                var dbcsCode = this.gb18030.gbChars[idx] + (uCode - this.gb18030.uChars[idx]);
                newBuf[j++] = 0x81 + Math.floor(dbcsCode / 12600); dbcsCode = dbcsCode % 12600;
                newBuf[j++] = 0x30 + Math.floor(dbcsCode / 1260); dbcsCode = dbcsCode % 1260;
                newBuf[j++] = 0x81 + Math.floor(dbcsCode / 10); dbcsCode = dbcsCode % 10;
                newBuf[j++] = 0x30 + dbcsCode;
                continue;
            }
        }
    }

    // 3. Write dbcsCode character.
    if (dbcsCode === UNASSIGNED)
        dbcsCode = this.defaultCharSingleByte;

    if (dbcsCode &lt; 0x100) {
        newBuf[j++] = dbcsCode;
    }
    else if (dbcsCode &lt; 0x10000) {
        newBuf[j++] = dbcsCode &gt;&gt; 8;   // high byte
        newBuf[j++] = dbcsCode &amp; 0xFF; // low byte
    }
    else {
        newBuf[j++] = dbcsCode &gt;&gt; 16;
        newBuf[j++] = (dbcsCode &gt;&gt; 8) &amp; 0xFF;
        newBuf[j++] = dbcsCode &amp; 0xFF;
    }
}

this.seqObj = seqObj;
this.leadSurrogate = leadSurrogate;
return newBuf.slice(0, j);</pre>

<p>}</p>

<p>DBCSEncoder.prototype.end = function() {</p>

<pre>if (this.leadSurrogate === -1 &amp;&amp; this.seqObj === undefined)
    return; // All clean. Most often case.

var newBuf = Buffer.alloc(10), j = 0;

if (this.seqObj) { // We&#39;re in the sequence.
    var dbcsCode = this.seqObj[DEF_CHAR];
    if (dbcsCode !== undefined) { // Write beginning of the sequence.
        if (dbcsCode &lt; 0x100) {
            newBuf[j++] = dbcsCode;
        }
        else {
            newBuf[j++] = dbcsCode &gt;&gt; 8;   // high byte
            newBuf[j++] = dbcsCode &amp; 0xFF; // low byte
        }
    } else {
        // See todo above.
    }
    this.seqObj = undefined;
}

if (this.leadSurrogate !== -1) {
    // Incomplete surrogate pair - only lead surrogate found.
    newBuf[j++] = this.defaultCharSingleByte;
    this.leadSurrogate = -1;
}

return newBuf.slice(0, j);</pre>

<p>}</p>

<p>// Export for testing DBCSEncoder.prototype.findIdx = findIdx;</p>

<p>// == Decoder
==================================================================</p>

<p>function DBCSDecoder(options, codec) {</p>

<pre>// Decoder state
this.nodeIdx = 0;
this.prevBuf = Buffer.alloc(0);

// Static data
this.decodeTables = codec.decodeTables;
this.decodeTableSeq = codec.decodeTableSeq;
this.defaultCharUnicode = codec.defaultCharUnicode;
this.gb18030 = codec.gb18030;</pre>

<p>}</p>

<p>DBCSDecoder.prototype.write = function(buf) {</p>

<pre>var newBuf = Buffer.alloc(buf.length*2),
    nodeIdx = this.nodeIdx, 
    prevBuf = this.prevBuf, prevBufOffset = this.prevBuf.length,
    seqStart = -this.prevBuf.length, // idx of the start of current parsed sequence.
    uCode;

if (prevBufOffset &gt; 0) // Make prev buf overlap a little to make it easier to slice later.
    prevBuf = Buffer.concat([prevBuf, buf.slice(0, 10)]);

for (var i = 0, j = 0; i &lt; buf.length; i++) {
    var curByte = (i &gt;= 0) ? buf[i] : prevBuf[i + prevBufOffset];

    // Lookup in current trie node.
    var uCode = this.decodeTables[nodeIdx][curByte];

    if (uCode &gt;= 0) { 
        // Normal character, just use it.
    }
    else if (uCode === UNASSIGNED) { // Unknown char.
        // TODO: Callback with seq.
        //var curSeq = (seqStart &gt;= 0) ? buf.slice(seqStart, i+1) : prevBuf.slice(seqStart + prevBufOffset, i+1 + prevBufOffset);
        i = seqStart; // Try to parse again, after skipping first byte of the sequence (&#39;i&#39; will be incremented by &#39;for&#39; cycle).
        uCode = this.defaultCharUnicode.charCodeAt(0);
    }
    else if (uCode === GB18030_CODE) {
        var curSeq = (seqStart &gt;= 0) ? buf.slice(seqStart, i+1) : prevBuf.slice(seqStart + prevBufOffset, i+1 + prevBufOffset);
        var ptr = (curSeq[0]-0x81)*12600 + (curSeq[1]-0x30)*1260 + (curSeq[2]-0x81)*10 + (curSeq[3]-0x30);
        var idx = findIdx(this.gb18030.gbChars, ptr);
        uCode = this.gb18030.uChars[idx] + ptr - this.gb18030.gbChars[idx];
    }
    else if (uCode &lt;= NODE_START) { // Go to next trie node.
        nodeIdx = NODE_START - uCode;
        continue;
    }
    else if (uCode &lt;= SEQ_START) { // Output a sequence of chars.
        var seq = this.decodeTableSeq[SEQ_START - uCode];
        for (var k = 0; k &lt; seq.length - 1; k++) {
            uCode = seq[k];
            newBuf[j++] = uCode &amp; 0xFF;
            newBuf[j++] = uCode &gt;&gt; 8;
        }
        uCode = seq[seq.length-1];
    }
    else
        throw new Error(&quot;iconv-lite internal error: invalid decoding table value &quot; + uCode + &quot; at &quot; + nodeIdx + &quot;/&quot; + curByte);

    // Write the character to buffer, handling higher planes using surrogate pair.
    if (uCode &gt; 0xFFFF) { 
        uCode -= 0x10000;
        var uCodeLead = 0xD800 + Math.floor(uCode / 0x400);
        newBuf[j++] = uCodeLead &amp; 0xFF;
        newBuf[j++] = uCodeLead &gt;&gt; 8;

        uCode = 0xDC00 + uCode % 0x400;
    }
    newBuf[j++] = uCode &amp; 0xFF;
    newBuf[j++] = uCode &gt;&gt; 8;

    // Reset trie node.
    nodeIdx = 0; seqStart = i+1;
}

this.nodeIdx = nodeIdx;
this.prevBuf = (seqStart &gt;= 0) ? buf.slice(seqStart) : prevBuf.slice(seqStart + prevBufOffset);
return newBuf.slice(0, j).toString(&#39;ucs2&#39;);</pre>

<p>}</p>

<p>DBCSDecoder.prototype.end = function() {</p>

<pre>var ret = &#39;&#39;;

// Try to parse all remaining chars.
while (this.prevBuf.length &gt; 0) {
    // Skip 1 character in the buffer.
    ret += this.defaultCharUnicode;
    var buf = this.prevBuf.slice(1);

    // Parse remaining as usual.
    this.prevBuf = Buffer.alloc(0);
    this.nodeIdx = 0;
    if (buf.length &gt; 0)
        ret += this.write(buf);
}

this.nodeIdx = 0;
return ret;</pre>

<p>}</p>

<p>// Binary search for GB18030. Returns largest i such that <a
href="i">table</a> &lt;= val. function findIdx(table, val) {</p>

<pre>if (table[0] &gt; val)
    return -1;

var l = 0, r = table.length;
while (l &lt; r-1) { // always table[l] &lt;= val &lt; table[r]
    var mid = l + Math.floor((r-l+1)/2);
    if (table[mid] &lt;= val)
        l = mid;
    else
        r = mid;
}
return l;</pre>

<p>}</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

