<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>index.js - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../Models/veggies_js.html">veggies.js</a>
  
    <li><a href="../../express-partner-lab/README_md.html">README</a>
  
    <li><a href="../../node_modules/accepts/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/accepts/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/accepts/README_md.html">README</a>
  
    <li><a href="../../node_modules/accepts/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/accepts/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/array-flatten/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/array-flatten/README_md.html">README</a>
  
    <li><a href="../../node_modules/array-flatten/array-flatten_js.html">array-flatten.js</a>
  
    <li><a href="../../node_modules/array-flatten/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/body-parser/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/body-parser/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/body-parser/README_md.html">README</a>
  
    <li><a href="../../node_modules/body-parser/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/body-parser/lib/read_js.html">read.js</a>
  
    <li><a href="../../node_modules/body-parser/lib/types/json_js.html">json.js</a>
  
    <li><a href="../../node_modules/body-parser/lib/types/raw_js.html">raw.js</a>
  
    <li><a href="../../node_modules/body-parser/lib/types/text_js.html">text.js</a>
  
    <li><a href="../../node_modules/body-parser/lib/types/urlencoded_js.html">urlencoded.js</a>
  
    <li><a href="../../node_modules/body-parser/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/bytes/History_md.html">History</a>
  
    <li><a href="../../node_modules/bytes/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/bytes/Readme_md.html">Readme</a>
  
    <li><a href="../../node_modules/bytes/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/bytes/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/content-disposition/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/content-disposition/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/content-disposition/README_md.html">README</a>
  
    <li><a href="../../node_modules/content-disposition/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/content-disposition/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/content-type/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/content-type/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/content-type/README_md.html">README</a>
  
    <li><a href="../../node_modules/content-type/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/content-type/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/cookie-signature/History_md.html">History</a>
  
    <li><a href="../../node_modules/cookie-signature/Readme_md.html">Readme</a>
  
    <li><a href="../../node_modules/cookie-signature/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/cookie-signature/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/cookie/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/cookie/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/cookie/README_md.html">README</a>
  
    <li><a href="../../node_modules/cookie/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/cookie/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/debug/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../node_modules/debug/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/debug/Makefile.html">Makefile</a>
  
    <li><a href="../../node_modules/debug/README_md.html">README</a>
  
    <li><a href="../../node_modules/debug/component_json.html">component.json</a>
  
    <li><a href="../../node_modules/debug/karma_conf_js.html">karma.conf.js</a>
  
    <li><a href="../../node_modules/debug/node_js.html">node.js</a>
  
    <li><a href="../../node_modules/debug/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/debug/src/browser_js.html">browser.js</a>
  
    <li><a href="../../node_modules/debug/src/debug_js.html">debug.js</a>
  
    <li><a href="../../node_modules/debug/src/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/debug/src/inspector-log_js.html">inspector-log.js</a>
  
    <li><a href="../../node_modules/debug/src/node_js.html">node.js</a>
  
    <li><a href="../../node_modules/depd/History_md.html">History</a>
  
    <li><a href="../../node_modules/depd/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/depd/Readme_md.html">Readme</a>
  
    <li><a href="../../node_modules/depd/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/depd/lib/browser/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/depd/lib/compat/callsite-tostring_js.html">callsite-tostring.js</a>
  
    <li><a href="../../node_modules/depd/lib/compat/event-listener-count_js.html">event-listener-count.js</a>
  
    <li><a href="../../node_modules/depd/lib/compat/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/depd/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/destroy/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/destroy/README_md.html">README</a>
  
    <li><a href="../../node_modules/destroy/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/destroy/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/ee-first/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/ee-first/README_md.html">README</a>
  
    <li><a href="../../node_modules/ee-first/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/ee-first/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/ejs/Jakefile.html">Jakefile</a>
  
    <li><a href="../../node_modules/ejs/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/ejs/README_md.html">README</a>
  
    <li><a href="../../node_modules/ejs/ejs_js.html">ejs.js</a>
  
    <li><a href="../../node_modules/ejs/ejs_min_js.html">ejs.min.js</a>
  
    <li><a href="../../node_modules/ejs/lib/ejs_js.html">ejs.js</a>
  
    <li><a href="../../node_modules/ejs/lib/utils_js.html">utils.js</a>
  
    <li><a href="../../node_modules/ejs/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/encodeurl/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/encodeurl/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/encodeurl/README_md.html">README</a>
  
    <li><a href="../../node_modules/encodeurl/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/encodeurl/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/escape-html/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/escape-html/Readme_md.html">Readme</a>
  
    <li><a href="../../node_modules/escape-html/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/escape-html/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/etag/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/etag/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/etag/README_md.html">README</a>
  
    <li><a href="../../node_modules/etag/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/etag/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/express/History_md.html">History</a>
  
    <li><a href="../../node_modules/express/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/express/Readme_md.html">Readme</a>
  
    <li><a href="../../node_modules/express/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/express/lib/application_js.html">application.js</a>
  
    <li><a href="../../node_modules/express/lib/express_js.html">express.js</a>
  
    <li><a href="../../node_modules/express/lib/middleware/init_js.html">init.js</a>
  
    <li><a href="../../node_modules/express/lib/middleware/query_js.html">query.js</a>
  
    <li><a href="../../node_modules/express/lib/request_js.html">request.js</a>
  
    <li><a href="../../node_modules/express/lib/response_js.html">response.js</a>
  
    <li><a href="../../node_modules/express/lib/router/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/express/lib/router/layer_js.html">layer.js</a>
  
    <li><a href="../../node_modules/express/lib/router/route_js.html">route.js</a>
  
    <li><a href="../../node_modules/express/lib/utils_js.html">utils.js</a>
  
    <li><a href="../../node_modules/express/lib/view_js.html">view.js</a>
  
    <li><a href="../../node_modules/express/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/finalhandler/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/finalhandler/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/finalhandler/README_md.html">README</a>
  
    <li><a href="../../node_modules/finalhandler/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/finalhandler/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/forwarded/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/forwarded/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/forwarded/README_md.html">README</a>
  
    <li><a href="../../node_modules/forwarded/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/forwarded/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/fresh/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/fresh/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/fresh/README_md.html">README</a>
  
    <li><a href="../../node_modules/fresh/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/fresh/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/http-errors/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/http-errors/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/http-errors/README_md.html">README</a>
  
    <li><a href="../../node_modules/http-errors/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/http-errors/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/iconv-lite/Changelog_md.html">Changelog</a>
  
    <li><a href="../../node_modules/iconv-lite/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/iconv-lite/README_md.html">README</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/dbcs-codec_js.html">dbcs-codec.js</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/dbcs-data_js.html">dbcs-data.js</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/internal_js.html">internal.js</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/sbcs-codec_js.html">sbcs-codec.js</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/sbcs-data-generated_js.html">sbcs-data-generated.js</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/sbcs-data_js.html">sbcs-data.js</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/tables/big5-added_json.html">big5-added.json</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/tables/cp936_json.html">cp936.json</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/tables/cp949_json.html">cp949.json</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/tables/cp950_json.html">cp950.json</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/tables/eucjp_json.html">eucjp.json</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/tables/gb18030-ranges_json.html">gb18030-ranges.json</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/tables/gbk-added_json.html">gbk-added.json</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/tables/shiftjis_json.html">shiftjis.json</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/utf16_js.html">utf16.js</a>
  
    <li><a href="../../node_modules/iconv-lite/encodings/utf7_js.html">utf7.js</a>
  
    <li><a href="../../node_modules/iconv-lite/lib/bom-handling_js.html">bom-handling.js</a>
  
    <li><a href="../../node_modules/iconv-lite/lib/extend-node_js.html">extend-node.js</a>
  
    <li><a href="../../node_modules/iconv-lite/lib/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../node_modules/iconv-lite/lib/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/iconv-lite/lib/streams_js.html">streams.js</a>
  
    <li><a href="../../node_modules/iconv-lite/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/inherits/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/inherits/README_md.html">README</a>
  
    <li><a href="../../node_modules/inherits/inherits_js.html">inherits.js</a>
  
    <li><a href="../../node_modules/inherits/inherits_browser_js.html">inherits_browser.js</a>
  
    <li><a href="../../node_modules/inherits/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/ipaddr_js/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/ipaddr_js/README_md.html">README</a>
  
    <li><a href="../../node_modules/ipaddr_js/ipaddr_min_js.html">ipaddr.min.js</a>
  
    <li><a href="../../node_modules/ipaddr_js/lib/ipaddr_js.html">ipaddr.js</a>
  
    <li><a href="../../node_modules/ipaddr_js/lib/ipaddr_js_d_ts.html">ipaddr.js.d.ts</a>
  
    <li><a href="../../node_modules/ipaddr_js/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/media-typer/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/media-typer/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/media-typer/README_md.html">README</a>
  
    <li><a href="../../node_modules/media-typer/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/media-typer/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/merge-descriptors/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/merge-descriptors/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/merge-descriptors/README_md.html">README</a>
  
    <li><a href="../../node_modules/merge-descriptors/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/merge-descriptors/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/method-override/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/method-override/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/method-override/README_md.html">README</a>
  
    <li><a href="../../node_modules/method-override/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/Makefile.html">Makefile</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/README_md.html">README</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/karma_conf_js.html">karma.conf.js</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/node_js.html">node.js</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/src/browser_js.html">browser.js</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/src/debug_js.html">debug.js</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/src/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/method-override/node_modules/debug/src/node_js.html">node.js</a>
  
    <li><a href="../../node_modules/method-override/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/methods/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/methods/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/methods/README_md.html">README</a>
  
    <li><a href="../../node_modules/methods/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/methods/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/mime-db/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/mime-db/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/mime-db/README_md.html">README</a>
  
    <li><a href="../../node_modules/mime-db/db_json.html">db.json</a>
  
    <li><a href="../../node_modules/mime-db/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/mime-db/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/mime-types/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/mime-types/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/mime-types/README_md.html">README</a>
  
    <li><a href="../../node_modules/mime-types/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/mime-types/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/mime/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../node_modules/mime/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/mime/README_md.html">README</a>
  
    <li><a href="../../node_modules/mime/cli_js.html">cli.js</a>
  
    <li><a href="../../node_modules/mime/mime_js.html">mime.js</a>
  
    <li><a href="../../node_modules/mime/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/mime/src/build_js.html">build.js</a>
  
    <li><a href="../../node_modules/mime/src/test_js.html">test.js</a>
  
    <li><a href="../../node_modules/mime/types_json.html">types.json</a>
  
    <li><a href="../../node_modules/ms/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/ms/license_md.html">license</a>
  
    <li><a href="../../node_modules/ms/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/ms/readme_md.html">readme</a>
  
    <li><a href="../../node_modules/negotiator/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/negotiator/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/negotiator/README_md.html">README</a>
  
    <li><a href="../../node_modules/negotiator/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/negotiator/lib/charset_js.html">charset.js</a>
  
    <li><a href="../../node_modules/negotiator/lib/encoding_js.html">encoding.js</a>
  
    <li><a href="../../node_modules/negotiator/lib/language_js.html">language.js</a>
  
    <li><a href="../../node_modules/negotiator/lib/mediaType_js.html">mediaType.js</a>
  
    <li><a href="../../node_modules/negotiator/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/on-finished/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/on-finished/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/on-finished/README_md.html">README</a>
  
    <li><a href="../../node_modules/on-finished/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/on-finished/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/parseurl/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/parseurl/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/parseurl/README_md.html">README</a>
  
    <li><a href="../../node_modules/parseurl/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/parseurl/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/path-to-regexp/History_md.html">History</a>
  
    <li><a href="../../node_modules/path-to-regexp/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/path-to-regexp/Readme_md.html">Readme</a>
  
    <li><a href="../../node_modules/path-to-regexp/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/path-to-regexp/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/proxy-addr/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/proxy-addr/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/proxy-addr/README_md.html">README</a>
  
    <li><a href="../../node_modules/proxy-addr/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/proxy-addr/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/qs/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../node_modules/qs/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/qs/README_md.html">README</a>
  
    <li><a href="../../node_modules/qs/dist/qs_js.html">qs.js</a>
  
    <li><a href="../../node_modules/qs/lib/formats_js.html">formats.js</a>
  
    <li><a href="../../node_modules/qs/lib/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/qs/lib/parse_js.html">parse.js</a>
  
    <li><a href="../../node_modules/qs/lib/stringify_js.html">stringify.js</a>
  
    <li><a href="../../node_modules/qs/lib/utils_js.html">utils.js</a>
  
    <li><a href="../../node_modules/qs/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/qs/test/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/qs/test/parse_js.html">parse.js</a>
  
    <li><a href="../../node_modules/qs/test/stringify_js.html">stringify.js</a>
  
    <li><a href="../../node_modules/qs/test/utils_js.html">utils.js</a>
  
    <li><a href="../../node_modules/range-parser/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/range-parser/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/range-parser/README_md.html">README</a>
  
    <li><a href="../../node_modules/range-parser/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/range-parser/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/raw-body/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/raw-body/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/raw-body/README_md.html">README</a>
  
    <li><a href="../../node_modules/raw-body/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../node_modules/raw-body/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/raw-body/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/safe-buffer/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/safe-buffer/README_md.html">README</a>
  
    <li><a href="../../node_modules/safe-buffer/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../node_modules/safe-buffer/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/safe-buffer/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/safer-buffer/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/safer-buffer/Porting-Buffer_md.html">Porting-Buffer</a>
  
    <li><a href="../../node_modules/safer-buffer/Readme_md.html">Readme</a>
  
    <li><a href="../../node_modules/safer-buffer/dangerous_js.html">dangerous.js</a>
  
    <li><a href="../../node_modules/safer-buffer/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/safer-buffer/safer_js.html">safer.js</a>
  
    <li><a href="../../node_modules/safer-buffer/tests_js.html">tests.js</a>
  
    <li><a href="../../node_modules/send/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/send/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/send/README_md.html">README</a>
  
    <li><a href="../../node_modules/send/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/send/node_modules/ms/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/send/node_modules/ms/license_md.html">license</a>
  
    <li><a href="../../node_modules/send/node_modules/ms/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/send/node_modules/ms/readme_md.html">readme</a>
  
    <li><a href="../../node_modules/send/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/serve-static/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/serve-static/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/serve-static/README_md.html">README</a>
  
    <li><a href="../../node_modules/serve-static/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/serve-static/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/setprototypeof/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/setprototypeof/README_md.html">README</a>
  
    <li><a href="../../node_modules/setprototypeof/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../node_modules/setprototypeof/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/setprototypeof/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/setprototypeof/test/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/statuses/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/statuses/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/statuses/README_md.html">README</a>
  
    <li><a href="../../node_modules/statuses/codes_json.html">codes.json</a>
  
    <li><a href="../../node_modules/statuses/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/statuses/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/toidentifier/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/toidentifier/README_md.html">README</a>
  
    <li><a href="../../node_modules/toidentifier/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/toidentifier/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/type-is/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/type-is/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/type-is/README_md.html">README</a>
  
    <li><a href="../../node_modules/type-is/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/type-is/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/unpipe/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/unpipe/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/unpipe/README_md.html">README</a>
  
    <li><a href="../../node_modules/unpipe/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/unpipe/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/utils-merge/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/utils-merge/README_md.html">README</a>
  
    <li><a href="../../node_modules/utils-merge/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/utils-merge/package_json.html">package.json</a>
  
    <li><a href="../../node_modules/vary/HISTORY_md.html">HISTORY</a>
  
    <li><a href="../../node_modules/vary/LICENSE.html">LICENSE</a>
  
    <li><a href="../../node_modules/vary/README_md.html">README</a>
  
    <li><a href="../../node_modules/vary/index_js.html">index.js</a>
  
    <li><a href="../../node_modules/vary/package_json.html">package.json</a>
  
    <li><a href="../../package-lock_json.html">package-lock.json</a>
  
    <li><a href="../../package_json.html">package.json</a>
  
    <li><a href="../../server_js.html">server.js</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page node_modules/send/index.js">

<pre>!
 send
 Copyright(c) 2012 TJ Holowaychuk
 Copyright(c) 2014-2016 Douglas Christopher Wilson
 MIT Licensed</pre>

<p>&#39;use strict&#39;</p>

<pre> Module dependencies.
 @private
/</pre>

<p>var createError = require(&#39;http-errors&#39;) var debug =
require(&#39;debug&#39;)(&#39;send&#39;) var deprecate =
require(&#39;depd&#39;)(&#39;send&#39;) var destroy =
require(&#39;destroy&#39;) var encodeUrl = require(&#39;encodeurl&#39;) var
escapeHtml = require(&#39;escape-html&#39;) var etag =
require(&#39;etag&#39;) var fresh = require(&#39;fresh&#39;) var fs =
require(&#39;fs&#39;) var mime = require(&#39;mime&#39;) var ms =
require(&#39;ms&#39;) var onFinished = require(&#39;on-finished&#39;) var
parseRange = require(&#39;range-parser&#39;) var path =
require(&#39;path&#39;) var statuses = require(&#39;statuses&#39;) var
Stream = require(&#39;stream&#39;) var util = require(&#39;util&#39;)</p>

<p>/**</p>

<pre> Path function references.
 @private
/</pre>

<p>var extname = path.extname var join = path.join var normalize =
path.normalize var resolve = path.resolve var sep = path.sep</p>

<p>/**</p>

<pre> Regular expression for identifying a bytes Range header.
 @private
/</pre>

<p>var BYTES_RANGE_REGEXP = /^ *bytes=/</p>

<p>/**</p>

<pre> Maximum value allowed for the max age.
 @private
/</pre>

<p>var MAX_MAXAGE = 60 * 60 * 24 * 365 * 1000 // 1 year</p>

<p>/**</p>

<pre> Regular expression to match a path with a directory up component.
 @private
/</pre>

<p>var UP_PATH_REGEXP = /(?:^|[\/])..(?:[\/]|$)/</p>

<p>/**</p>

<pre> Module exports.
 @public
/</pre>

<p>module.exports = send module.exports.mime = mime</p>

<p>/**</p>

<pre> Return a `SendStream` for `req` and `path`.

 @param {object} req
 @param {string} path
 @param {object} [options]
 @return {SendStream}
 @public
/</pre>

<p>function send (req, path, options) {</p>

<pre class="ruby"><span class="ruby-keyword">return</span> <span class="ruby-identifier">new</span> <span class="ruby-constant">SendStream</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>)
</pre>

<p>}</p>

<p>/**</p>

<pre> Initialize a `SendStream` with the given `path`.

 @param {Request} req
 @param {String} path
 @param {object} [options]
 @private
/</pre>

<p>function SendStream (req, path, options) {</p>

<pre>Stream.call(this)

var opts = options || {}

this.options = opts
this.path = path
this.req = req

this._acceptRanges = opts.acceptRanges !== undefined
  ? Boolean(opts.acceptRanges)
  : true

this._cacheControl = opts.cacheControl !== undefined
  ? Boolean(opts.cacheControl)
  : true

this._etag = opts.etag !== undefined
  ? Boolean(opts.etag)
  : true

this._dotfiles = opts.dotfiles !== undefined
  ? opts.dotfiles
  : &#39;ignore&#39;

if (this._dotfiles !== &#39;ignore&#39; &amp;&amp; this._dotfiles !== &#39;allow&#39; &amp;&amp; this._dotfiles !== &#39;deny&#39;) {
  throw new TypeError(&#39;dotfiles option must be &quot;allow&quot;, &quot;deny&quot;, or &quot;ignore&quot;&#39;)
}

this._hidden = Boolean(opts.hidden)

if (opts.hidden !== undefined) {
  deprecate(&#39;hidden: use dotfiles: \&#39;&#39; + (this._hidden ? &#39;allow&#39; : &#39;ignore&#39;) + &#39;\&#39; instead&#39;)
}

// legacy support
if (opts.dotfiles === undefined) {
  this._dotfiles = undefined
}

this._extensions = opts.extensions !== undefined
  ? normalizeList(opts.extensions, &#39;extensions option&#39;)
  : []

this._immutable = opts.immutable !== undefined
  ? Boolean(opts.immutable)
  : false

this._index = opts.index !== undefined
  ? normalizeList(opts.index, &#39;index option&#39;)
  : [&#39;index.html&#39;]

this._lastModified = opts.lastModified !== undefined
  ? Boolean(opts.lastModified)
  : true

this._maxage = opts.maxAge || opts.maxage
this._maxage = typeof this._maxage === &#39;string&#39;
  ? ms(this._maxage)
  : Number(this._maxage)
this._maxage = !isNaN(this._maxage)
  ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE)
  : 0

this._root = opts.root
  ? resolve(opts.root)
  : null

if (!this._root &amp;&amp; opts.from) {
  this.from(opts.from)
}</pre>

<p>}</p>

<p>/**</p>

<pre class="ruby"> <span class="ruby-constant">Inherits</span> <span class="ruby-identifier">from</span> <span class="ruby-value">%x`Stream`</span>.
<span class="ruby-operator">/</span>
</pre>

<p>util.inherits(SendStream, Stream)</p>

<p>/**</p>

<pre> Enable or disable etag generation.

 @param {Boolean} val
 @return {SendStream}
 @api public
/</pre>

<p>SendStream.prototype.etag = deprecate.function(function etag (val) {</p>

<pre class="ruby"><span class="ruby-identifier">this</span>.<span class="ruby-identifier">_etag</span> = <span class="ruby-constant">Boolean</span>(<span class="ruby-identifier">val</span>)
<span class="ruby-identifier">debug</span>(<span class="ruby-string">&#39;etag %s&#39;</span>, <span class="ruby-identifier">this</span>.<span class="ruby-identifier">_etag</span>)
<span class="ruby-keyword">return</span> <span class="ruby-identifier">this</span>
</pre>

<p>}, &#39;send.etag: pass etag as option&#39;)</p>

<p>/**</p>

<pre> Enable or disable &quot;hidden&quot; (dot) files.

 @param {Boolean} path
 @return {SendStream}
 @api public
/</pre>

<p>SendStream.prototype.hidden = deprecate.function(function hidden (val) {</p>

<pre class="ruby"><span class="ruby-identifier">this</span>.<span class="ruby-identifier">_hidden</span> = <span class="ruby-constant">Boolean</span>(<span class="ruby-identifier">val</span>)
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">_dotfiles</span> = <span class="ruby-identifier">undefined</span>
<span class="ruby-identifier">debug</span>(<span class="ruby-string">&#39;hidden %s&#39;</span>, <span class="ruby-identifier">this</span>.<span class="ruby-identifier">_hidden</span>)
<span class="ruby-keyword">return</span> <span class="ruby-identifier">this</span>
</pre>

<p>}, &#39;send.hidden: use dotfiles option&#39;)</p>

<p>/**</p>

<pre> Set index `paths`, set to a falsy
 value to disable index support.

 @param {String|Boolean|Array} paths
 @return {SendStream}
 @api public
/</pre>

<p>SendStream.prototype.index = deprecate.function(function index (paths) {</p>

<pre class="ruby"><span class="ruby-identifier">var</span> <span class="ruby-identifier">index</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">paths</span> <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> <span class="ruby-identifier">normalizeList</span>(<span class="ruby-identifier">paths</span>, <span class="ruby-string">&#39;paths argument&#39;</span>)
<span class="ruby-identifier">debug</span>(<span class="ruby-string">&#39;index %o&#39;</span>, <span class="ruby-identifier">paths</span>)
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">_index</span> = <span class="ruby-identifier">index</span>
<span class="ruby-keyword">return</span> <span class="ruby-identifier">this</span>
</pre>

<p>}, &#39;send.index: pass index as option&#39;)</p>

<p>/**</p>

<pre> Set root `path`.

 @param {String} path
 @return {SendStream}
 @api public
/</pre>

<p>SendStream.prototype.root = function root (path) {</p>

<pre class="ruby"><span class="ruby-identifier">this</span>.<span class="ruby-identifier">_root</span> = <span class="ruby-identifier">resolve</span>(<span class="ruby-constant">String</span>(<span class="ruby-identifier">path</span>))
<span class="ruby-identifier">debug</span>(<span class="ruby-string">&#39;root %s&#39;</span>, <span class="ruby-identifier">this</span>.<span class="ruby-identifier">_root</span>)
<span class="ruby-keyword">return</span> <span class="ruby-identifier">this</span>
</pre>

<p>}</p>

<p>SendStream.prototype.from = deprecate.function(SendStream.prototype.root,</p>

<pre>&#39;send.from: pass root as option&#39;)</pre>

<p>SendStream.prototype.root = deprecate.function(SendStream.prototype.root,</p>

<pre>&#39;send.root: pass root as option&#39;)</pre>

<p>/**</p>

<pre> Set max-age to `maxAge`.

 @param {Number} maxAge
 @return {SendStream}
 @api public
/</pre>

<p>SendStream.prototype.maxage = deprecate.function(function maxage (maxAge) {</p>

<pre>this._maxage = typeof maxAge === &#39;string&#39;
  ? ms(maxAge)
  : Number(maxAge)
this._maxage = !isNaN(this._maxage)
  ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE)
  : 0
debug(&#39;max-age %d&#39;, this._maxage)
return this</pre>

<p>}, &#39;send.maxage: pass maxAge as option&#39;)</p>

<p>/**</p>

<pre> Emit error with `status`.

 @param {number} status
 @param {Error} [err]
 @private
/</pre>

<p>SendStream.prototype.error = function error (status, err) {</p>

<pre>// emit if listeners instead of responding
if (hasListeners(this, &#39;error&#39;)) {
  return this.emit(&#39;error&#39;, createError(status, err, {
    expose: false
  }))
}

var res = this.res
var msg = statuses[status] || String(status)
var doc = createHtmlDocument(&#39;Error&#39;, escapeHtml(msg))

// clear existing headers
clearHeaders(res)

// add error headers
if (err &amp;&amp; err.headers) {
  setHeaders(res, err.headers)
}

// send basic response
res.statusCode = status
res.setHeader(&#39;Content-Type&#39;, &#39;text/html; charset=UTF-8&#39;)
res.setHeader(&#39;Content-Length&#39;, Buffer.byteLength(doc))
res.setHeader(&#39;Content-Security-Policy&#39;, &quot;default-src &#39;none&#39;&quot;)
res.setHeader(&#39;X-Content-Type-Options&#39;, &#39;nosniff&#39;)
res.end(doc)</pre>

<p>}</p>

<p>/**</p>

<pre> Check if the pathname ends with &quot;/&quot;.

 @return {boolean}
 @private
/</pre>

<p>SendStream.prototype.hasTrailingSlash = function hasTrailingSlash () {</p>

<pre class="ruby"><span class="ruby-keyword">return</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">path</span>[<span class="ruby-identifier">this</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>] <span class="ruby-operator">===</span> <span class="ruby-string">&#39;/&#39;</span>
</pre>

<p>}</p>

<p>/**</p>

<pre> Check if this is a conditional GET request.

 @return {Boolean}
 @api private
/</pre>

<p>SendStream.prototype.isConditionalGET = function isConditionalGET () {</p>

<pre class="ruby"><span class="ruby-keyword">return</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;if-match&#39;</span>] <span class="ruby-operator">||</span>
  <span class="ruby-identifier">this</span>.<span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;if-unmodified-since&#39;</span>] <span class="ruby-operator">||</span>
  <span class="ruby-identifier">this</span>.<span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;if-none-match&#39;</span>] <span class="ruby-operator">||</span>
  <span class="ruby-identifier">this</span>.<span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;if-modified-since&#39;</span>]
</pre>

<p>}</p>

<p>/**</p>

<pre> Check if the request preconditions failed.

 @return {boolean}
 @private
/</pre>

<p>SendStream.prototype.isPreconditionFailure = function isPreconditionFailure
() {</p>

<pre>var req = this.req
var res = this.res

// if-match
var match = req.headers[&#39;if-match&#39;]
if (match) {
  var etag = res.getHeader(&#39;ETag&#39;)
  return !etag || (match !== &#39;*&#39; &amp;&amp; parseTokenList(match).every(function (match) {
    return match !== etag &amp;&amp; match !== &#39;W/&#39; + etag &amp;&amp; &#39;W/&#39; + match !== etag
  }))
}

// if-unmodified-since
var unmodifiedSince = parseHttpDate(req.headers[&#39;if-unmodified-since&#39;])
if (!isNaN(unmodifiedSince)) {
  var lastModified = parseHttpDate(res.getHeader(&#39;Last-Modified&#39;))
  return isNaN(lastModified) || lastModified &gt; unmodifiedSince
}

return false</pre>

<p>}</p>

<p>/**</p>

<pre> Strip content-* header fields.

 @private
/</pre>

<p>SendStream.prototype.removeContentHeaderFields = function
removeContentHeaderFields () {</p>

<pre>var res = this.res
var headers = getHeaderNames(res)

for (var i = 0; i &lt; headers.length; i++) {
  var header = headers[i]
  if (header.substr(0, 8) === &#39;content-&#39; &amp;&amp; header !== &#39;content-location&#39;) {
    res.removeHeader(header)
  }
}</pre>

<p>}</p>

<p>/**</p>

<pre> Respond with 304 not modified.

 @api private
/</pre>

<p>SendStream.prototype.notModified = function notModified () {</p>

<pre class="ruby"><span class="ruby-identifier">var</span> <span class="ruby-identifier">res</span> = <span class="ruby-identifier">this</span>.<span class="ruby-identifier">res</span>
<span class="ruby-identifier">debug</span>(<span class="ruby-string">&#39;not modified&#39;</span>)
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">removeContentHeaderFields</span>()
<span class="ruby-identifier">res</span>.<span class="ruby-identifier">statusCode</span> = <span class="ruby-value">304</span>
<span class="ruby-identifier">res</span>.<span class="ruby-identifier">end</span>()
</pre>

<p>}</p>

<p>/**</p>

<pre> Raise error that headers already sent.

 @api private
/</pre>

<p>SendStream.prototype.headersAlreadySent = function headersAlreadySent () {</p>

<pre>var err = new Error(&#39;Can\&#39;t set headers after they are sent.&#39;)
debug(&#39;headers already sent&#39;)
this.error(500, err)</pre>

<p>}</p>

<p>/**</p>

<pre> Check if the request is cacheable, aka
 responded with 2xx or 304 (see RFC 2616 section 14.2{5,6}).

 @return {Boolean}
 @api private
/</pre>

<p>SendStream.prototype.isCachable = function isCachable () {</p>

<pre class="ruby"><span class="ruby-identifier">var</span> <span class="ruby-identifier">statusCode</span> = <span class="ruby-identifier">this</span>.<span class="ruby-identifier">res</span>.<span class="ruby-identifier">statusCode</span>
<span class="ruby-keyword">return</span> (<span class="ruby-identifier">statusCode</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">200</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">statusCode</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">300</span>) <span class="ruby-operator">||</span>
  <span class="ruby-identifier">statusCode</span> <span class="ruby-operator">===</span> <span class="ruby-value">304</span>
</pre>

<p>}</p>

<p>/**</p>

<pre> Handle stat() error.

 @param {Error} error
 @private
/</pre>

<p>SendStream.prototype.onStatError = function onStatError (error) {</p>

<pre>switch (error.code) {
  case &#39;ENAMETOOLONG&#39;:
  case &#39;ENOENT&#39;:
  case &#39;ENOTDIR&#39;:
    this.error(404, error)
    break
  default:
    this.error(500, error)
    break
}</pre>

<p>}</p>

<p>/**</p>

<pre> Check if the cache is fresh.

 @return {Boolean}
 @api private
/</pre>

<p>SendStream.prototype.isFresh = function isFresh () {</p>

<pre class="ruby"><span class="ruby-keyword">return</span> <span class="ruby-identifier">fresh</span>(<span class="ruby-identifier">this</span>.<span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>, {
  <span class="ruby-string">&#39;etag&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">res</span>.<span class="ruby-identifier">getHeader</span>(<span class="ruby-string">&#39;ETag&#39;</span>),
  <span class="ruby-string">&#39;last-modified&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">res</span>.<span class="ruby-identifier">getHeader</span>(<span class="ruby-string">&#39;Last-Modified&#39;</span>)
})
</pre>

<p>}</p>

<p>/**</p>

<pre> Check if the range is fresh.

 @return {Boolean}
 @api private
/</pre>

<p>SendStream.prototype.isRangeFresh = function isRangeFresh () {</p>

<pre>var ifRange = this.req.headers[&#39;if-range&#39;]

if (!ifRange) {
  return true
}

// if-range as etag
if (ifRange.indexOf(&#39;&quot;&#39;) !== -1) {
  var etag = this.res.getHeader(&#39;ETag&#39;)
  return Boolean(etag &amp;&amp; ifRange.indexOf(etag) !== -1)
}

// if-range as modified date
var lastModified = this.res.getHeader(&#39;Last-Modified&#39;)
return parseHttpDate(lastModified) &lt;= parseHttpDate(ifRange)</pre>

<p>}</p>

<p>/**</p>

<pre> Redirect to path.

 @param {string} path
 @private
/</pre>

<p>SendStream.prototype.redirect = function redirect (path) {</p>

<pre>var res = this.res

if (hasListeners(this, &#39;directory&#39;)) {
  this.emit(&#39;directory&#39;, res, path)
  return
}

if (this.hasTrailingSlash()) {
  this.error(403)
  return
}

var loc = encodeUrl(collapseLeadingSlashes(this.path + &#39;/&#39;))
var doc = createHtmlDocument(&#39;Redirecting&#39;, &#39;Redirecting to &lt;a href=&quot;&#39; + escapeHtml(loc) + &#39;&quot;&gt;&#39; +
  escapeHtml(loc) + &#39;&lt;/a&gt;&#39;)

// redirect
res.statusCode = 301
res.setHeader(&#39;Content-Type&#39;, &#39;text/html; charset=UTF-8&#39;)
res.setHeader(&#39;Content-Length&#39;, Buffer.byteLength(doc))
res.setHeader(&#39;Content-Security-Policy&#39;, &quot;default-src &#39;none&#39;&quot;)
res.setHeader(&#39;X-Content-Type-Options&#39;, &#39;nosniff&#39;)
res.setHeader(&#39;Location&#39;, loc)
res.end(doc)</pre>

<p>}</p>

<p>/**</p>

<pre> Pipe to `res.

 @param {Stream} res
 @return {Stream} res
 @api public
/</pre>

<p>SendStream.prototype.pipe = function pipe (res) {</p>

<pre>// root path
var root = this._root

// references
this.res = res

// decode the path
var path = decode(this.path)
if (path === -1) {
  this.error(400)
  return res
}

// null byte(s)
if (~path.indexOf(&#39;\0&#39;)) {
  this.error(400)
  return res
}

var parts
if (root !== null) {
  // normalize
  if (path) {
    path = normalize(&#39;.&#39; + sep + path)
  }

  // malicious path
  if (UP_PATH_REGEXP.test(path)) {
    debug(&#39;malicious path &quot;%s&quot;&#39;, path)
    this.error(403)
    return res
  }

  // explode path parts
  parts = path.split(sep)

  // join / normalize from optional root dir
  path = normalize(join(root, path))
} else {
  // &quot;..&quot; is malicious without &quot;root&quot;
  if (UP_PATH_REGEXP.test(path)) {
    debug(&#39;malicious path &quot;%s&quot;&#39;, path)
    this.error(403)
    return res
  }

  // explode path parts
  parts = normalize(path).split(sep)

  // resolve the path
  path = resolve(path)
}

// dotfile handling
if (containsDotFile(parts)) {
  var access = this._dotfiles

  // legacy support
  if (access === undefined) {
    access = parts[parts.length - 1][0] === &#39;.&#39;
      ? (this._hidden ? &#39;allow&#39; : &#39;ignore&#39;)
      : &#39;allow&#39;
  }

  debug(&#39;%s dotfile &quot;%s&quot;&#39;, access, path)
  switch (access) {
    case &#39;allow&#39;:
      break
    case &#39;deny&#39;:
      this.error(403)
      return res
    case &#39;ignore&#39;:
    default:
      this.error(404)
      return res
  }
}

// index file support
if (this._index.length &amp;&amp; this.hasTrailingSlash()) {
  this.sendIndex(path)
  return res
}

this.sendFile(path)
return res</pre>

<p>}</p>

<p>/**</p>

<pre> Transfer `path`.

 @param {String} path
 @api public
/</pre>

<p>SendStream.prototype.send = function send (path, stat) {</p>

<pre>var len = stat.size
var options = this.options
var opts = {}
var res = this.res
var req = this.req
var ranges = req.headers.range
var offset = options.start || 0

if (headersSent(res)) {
  // impossible to send now
  this.headersAlreadySent()
  return
}

debug(&#39;pipe &quot;%s&quot;&#39;, path)

// set header fields
this.setHeader(path, stat)

// set content-type
this.type(path)

// conditional GET support
if (this.isConditionalGET()) {
  if (this.isPreconditionFailure()) {
    this.error(412)
    return
  }

  if (this.isCachable() &amp;&amp; this.isFresh()) {
    this.notModified()
    return
  }
}

// adjust len to start/end options
len = Math.max(0, len - offset)
if (options.end !== undefined) {
  var bytes = options.end - offset + 1
  if (len &gt; bytes) len = bytes
}

// Range support
if (this._acceptRanges &amp;&amp; BYTES_RANGE_REGEXP.test(ranges)) {
  // parse
  ranges = parseRange(len, ranges, {
    combine: true
  })

  // If-Range support
  if (!this.isRangeFresh()) {
    debug(&#39;range stale&#39;)
    ranges = -2
  }

  // unsatisfiable
  if (ranges === -1) {
    debug(&#39;range unsatisfiable&#39;)

    // Content-Range
    res.setHeader(&#39;Content-Range&#39;, contentRange(&#39;bytes&#39;, len))

    // 416 Requested Range Not Satisfiable
    return this.error(416, {
      headers: { &#39;Content-Range&#39;: res.getHeader(&#39;Content-Range&#39;) }
    })
  }

  // valid (syntactically invalid/multiple ranges are treated as a regular response)
  if (ranges !== -2 &amp;&amp; ranges.length === 1) {
    debug(&#39;range %j&#39;, ranges)

    // Content-Range
    res.statusCode = 206
    res.setHeader(&#39;Content-Range&#39;, contentRange(&#39;bytes&#39;, len, ranges[0]))

    // adjust for requested range
    offset += ranges[0].start
    len = ranges[0].end - ranges[0].start + 1
  }
}

// clone options
for (var prop in options) {
  opts[prop] = options[prop]
}

// set read options
opts.start = offset
opts.end = Math.max(offset, offset + len - 1)

// content-length
res.setHeader(&#39;Content-Length&#39;, len)

// HEAD support
if (req.method === &#39;HEAD&#39;) {
  res.end()
  return
}

this.stream(path, opts)</pre>

<p>}</p>

<p>/**</p>

<pre> Transfer file for `path`.

 @param {String} path
 @api private
/</pre>

<p>SendStream.prototype.sendFile = function sendFile (path) {</p>

<pre>var i = 0
var self = this

debug(&#39;stat &quot;%s&quot;&#39;, path)
fs.stat(path, function onstat (err, stat) {
  if (err &amp;&amp; err.code === &#39;ENOENT&#39; &amp;&amp; !extname(path) &amp;&amp; path[path.length - 1] !== sep) {
    // not found, check extensions
    return next(err)
  }
  if (err) return self.onStatError(err)
  if (stat.isDirectory()) return self.redirect(path)
  self.emit(&#39;file&#39;, path, stat)
  self.send(path, stat)
})

function next (err) {
  if (self._extensions.length &lt;= i) {
    return err
      ? self.onStatError(err)
      : self.error(404)
  }

  var p = path + &#39;.&#39; + self._extensions[i++]

  debug(&#39;stat &quot;%s&quot;&#39;, p)
  fs.stat(p, function (err, stat) {
    if (err) return next(err)
    if (stat.isDirectory()) return next()
    self.emit(&#39;file&#39;, p, stat)
    self.send(p, stat)
  })
}</pre>

<p>}</p>

<p>/**</p>

<pre> Transfer index for `path`.

 @param {String} path
 @api private
/</pre>

<p>SendStream.prototype.sendIndex = function sendIndex (path) {</p>

<pre>var i = -1
var self = this

function next (err) {
  if (++i &gt;= self._index.length) {
    if (err) return self.onStatError(err)
    return self.error(404)
  }

  var p = join(path, self._index[i])

  debug(&#39;stat &quot;%s&quot;&#39;, p)
  fs.stat(p, function (err, stat) {
    if (err) return next(err)
    if (stat.isDirectory()) return next()
    self.emit(&#39;file&#39;, p, stat)
    self.send(p, stat)
  })
}

next()</pre>

<p>}</p>

<p>/**</p>

<pre> Stream `path` to the response.

 @param {String} path
 @param {Object} options
 @api private
/</pre>

<p>SendStream.prototype.stream = function stream (path, options) {</p>

<pre>// TODO: this is all lame, refactor meeee
var finished = false
var self = this
var res = this.res

// pipe
var stream = fs.createReadStream(path, options)
this.emit(&#39;stream&#39;, stream)
stream.pipe(res)

// response finished, done with the fd
onFinished(res, function onfinished () {
  finished = true
  destroy(stream)
})

// error handling code-smell
stream.on(&#39;error&#39;, function onerror (err) {
  // request already finished
  if (finished) return

  // clean up stream
  finished = true
  destroy(stream)

  // error
  self.onStatError(err)
})

// end
stream.on(&#39;end&#39;, function onend () {
  self.emit(&#39;end&#39;)
})</pre>

<p>}</p>

<p>/**</p>

<pre> Set content-type based on `path`
 if it hasn&#39;t been explicitly set.

 @param {String} path
 @api private
/</pre>

<p>SendStream.prototype.type = function type (path) {</p>

<pre>var res = this.res

if (res.getHeader(&#39;Content-Type&#39;)) return

var type = mime.lookup(path)

if (!type) {
  debug(&#39;no content-type&#39;)
  return
}

var charset = mime.charsets.lookup(type)

debug(&#39;content-type %s&#39;, type)
res.setHeader(&#39;Content-Type&#39;, type + (charset ? &#39;; charset=&#39; + charset : &#39;&#39;))</pre>

<p>}</p>

<p>/**</p>

<pre> Set response header fields, most
 fields may be pre-defined.

 @param {String} path
 @param {Object} stat
 @api private
/</pre>

<p>SendStream.prototype.setHeader = function setHeader (path, stat) {</p>

<pre>var res = this.res

this.emit(&#39;headers&#39;, res, path, stat)

if (this._acceptRanges &amp;&amp; !res.getHeader(&#39;Accept-Ranges&#39;)) {
  debug(&#39;accept ranges&#39;)
  res.setHeader(&#39;Accept-Ranges&#39;, &#39;bytes&#39;)
}

if (this._cacheControl &amp;&amp; !res.getHeader(&#39;Cache-Control&#39;)) {
  var cacheControl = &#39;public, max-age=&#39; + Math.floor(this._maxage / 1000)

  if (this._immutable) {
    cacheControl += &#39;, immutable&#39;
  }

  debug(&#39;cache-control %s&#39;, cacheControl)
  res.setHeader(&#39;Cache-Control&#39;, cacheControl)
}

if (this._lastModified &amp;&amp; !res.getHeader(&#39;Last-Modified&#39;)) {
  var modified = stat.mtime.toUTCString()
  debug(&#39;modified %s&#39;, modified)
  res.setHeader(&#39;Last-Modified&#39;, modified)
}

if (this._etag &amp;&amp; !res.getHeader(&#39;ETag&#39;)) {
  var val = etag(stat)
  debug(&#39;etag %s&#39;, val)
  res.setHeader(&#39;ETag&#39;, val)
}</pre>

<p>}</p>

<p>/**</p>

<pre> Clear all headers from a response.

 @param {object} res
 @private
/</pre>

<p>function clearHeaders (res) {</p>

<pre>var headers = getHeaderNames(res)

for (var i = 0; i &lt; headers.length; i++) {
  res.removeHeader(headers[i])
}</pre>

<p>}</p>

<p>/**</p>

<pre> Collapse all leading slashes into a single slash

 @param {string} str
 @private
/</pre>

<p>function collapseLeadingSlashes (str) {</p>

<pre>for (var i = 0; i &lt; str.length; i++) {
  if (str[i] !== &#39;/&#39;) {
    break
  }
}

return i &gt; 1
  ? &#39;/&#39; + str.substr(i)
  : str</pre>

<p>}</p>

<p>/**</p>

<pre> Determine if path parts contain a dotfile.

 @api private
/</pre>

<p>function containsDotFile (parts) {</p>

<pre>for (var i = 0; i &lt; parts.length; i++) {
  var part = parts[i]
  if (part.length &gt; 1 &amp;&amp; part[0] === &#39;.&#39;) {
    return true
  }
}

return false</pre>

<p>}</p>

<p>/**</p>

<pre> Create a Content-Range header.

 @param {string} type
 @param {number} size
 @param {array} [range]
/</pre>

<p>function contentRange (type, size, range) {</p>

<pre class="ruby"><span class="ruby-keyword">return</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">range</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">range</span>.<span class="ruby-identifier">start</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;-&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">range</span>.<span class="ruby-identifier">end</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;*&#39;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">size</span>
</pre>

<p>}</p>

<p>/**</p>

<pre> Create a minimal HTML document.

 @param {string} title
 @param {string} body
 @private
/</pre>

<p>function createHtmlDocument (title, body) {</p>

<pre class="ruby"><span class="ruby-keyword">return</span> <span class="ruby-string">&#39;&lt;!DOCTYPE html&gt;\n&#39;</span> <span class="ruby-operator">+</span>
  <span class="ruby-string">&#39;&lt;html lang=&quot;en&quot;&gt;\n&#39;</span> <span class="ruby-operator">+</span>
  <span class="ruby-string">&#39;&lt;head&gt;\n&#39;</span> <span class="ruby-operator">+</span>
  <span class="ruby-string">&#39;&lt;meta charset=&quot;utf-8&quot;&gt;\n&#39;</span> <span class="ruby-operator">+</span>
  <span class="ruby-string">&#39;&lt;title&gt;&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;&lt;/title&gt;\n&#39;</span> <span class="ruby-operator">+</span>
  <span class="ruby-string">&#39;&lt;/head&gt;\n&#39;</span> <span class="ruby-operator">+</span>
  <span class="ruby-string">&#39;&lt;body&gt;\n&#39;</span> <span class="ruby-operator">+</span>
  <span class="ruby-string">&#39;&lt;pre&gt;&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">body</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;&lt;/pre&gt;\n&#39;</span> <span class="ruby-operator">+</span>
  <span class="ruby-string">&#39;&lt;/body&gt;\n&#39;</span> <span class="ruby-operator">+</span>
  <span class="ruby-string">&#39;&lt;/html&gt;\n&#39;</span>
</pre>

<p>}</p>

<p>/**</p>

<pre> decodeURIComponent.

 Allows V8 to only deoptimize this fn instead of all
 of send().

 @param {String} path
 @api private
/</pre>

<p>function decode (path) {</p>

<pre>try {
  return decodeURIComponent(path)
} catch (err) {
  return -1
}</pre>

<p>}</p>

<p>/**</p>

<pre> Get the header names on a respnse.

 @param {object} res
 @returns {array[string]}
 @private
/</pre>

<p>function getHeaderNames (res) {</p>

<pre>return typeof res.getHeaderNames !== &#39;function&#39;
  ? Object.keys(res._headers || {})
  : res.getHeaderNames()</pre>

<p>}</p>

<p>/**</p>

<pre> Determine if emitter has listeners of a given type.

 The way to do this check is done three different ways in Node.js &gt;= 0.8
 so this consolidates them into a minimal set using instance methods.

 @param {EventEmitter} emitter
 @param {string} type
 @returns {boolean}
 @private
/</pre>

<p>function hasListeners (emitter, type) {</p>

<pre>var count = typeof emitter.listenerCount !== &#39;function&#39;
  ? emitter.listeners(type).length
  : emitter.listenerCount(type)

return count &gt; 0</pre>

<p>}</p>

<p>/**</p>

<pre> Determine if the response headers have been sent.

 @param {object} res
 @returns {boolean}
 @private
/</pre>

<p>function headersSent (res) {</p>

<pre>return typeof res.headersSent !== &#39;boolean&#39;
  ? Boolean(res._header)
  : res.headersSent</pre>

<p>}</p>

<p>/**</p>

<pre> Normalize the index option into an array.

 @param {boolean|string|array} val
 @param {string} name
 @private
/</pre>

<p>function normalizeList (val, name) {</p>

<pre>var list = [].concat(val || [])

for (var i = 0; i &lt; list.length; i++) {
  if (typeof list[i] !== &#39;string&#39;) {
    throw new TypeError(name + &#39; must be array of strings or false&#39;)
  }
}

return list</pre>

<p>}</p>

<p>/**</p>

<pre> Parse an HTTP Date into a number.

 @param {string} date
 @private
/</pre>

<p>function parseHttpDate (date) {</p>

<pre>var timestamp = date &amp;&amp; Date.parse(date)

return typeof timestamp === &#39;number&#39;
  ? timestamp
  : NaN</pre>

<p>}</p>

<p>/**</p>

<pre> Parse a HTTP token list.

 @param {string} str
 @private
/</pre>

<p>function parseTokenList (str) {</p>

<pre>var end = 0
var list = []
var start = 0

// gather tokens
for (var i = 0, len = str.length; i &lt; len; i++) {
  switch (str.charCodeAt(i)) {
    case 0x20: /*     
      if (start === end) {
        start = end = i + 1
      }
      break
    case 0x2c: /* , */
      list.push(str.substring(start, end))
      start = end = i + 1
      break
    default:
      end = i + 1
      break
  }
}

// final token
list.push(str.substring(start, end))

return list</pre>

<p>}</p>

<p>/**</p>

<pre> Set an object of headers on a response.

 @param {object} res
 @param {object} headers
 @private
/</pre>

<p>function setHeaders (res, headers) {</p>

<pre>var keys = Object.keys(headers)

for (var i = 0; i &lt; keys.length; i++) {
  var key = keys[i]
  res.setHeader(key, headers[key])
}</pre>

<p>}</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

